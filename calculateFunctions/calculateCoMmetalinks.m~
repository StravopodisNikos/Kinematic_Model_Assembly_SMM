function [g_s_link_as,M_s_link_as] = calculateCoMmetalinks(M_s_com_k_i,g_s_com_k_i)
% Given the 4D matrices extracted for each link it calculates the:
% 1. metalink CoM
% 2. metalink Inertia Matrix

% Metalink Inertia Matrix w.r.t. spatial frame!
for link_count=1:size(M_s_com_k_i,3)
    for bodies_cnt =1:size(M_s_com_k_i,4)
        M_s_link_as(:,:,link_count) = M_s_link_as(:,:,link_count) + M_s_com_k_i(:,:,link_count,bodies_cnt);   % Final Link Inertia Matrices of robot w.r.t. {S} frame
    end
end

% Com
for link_count=1:size(M_s_com_k_i,3)
    mass_of_metalink(link_count) = M_s_link_as(1,1,link_count);

    for bodies_cnt =1:size(M_s_com_k_i,4)
        mass_of_body_of_metalink(bodies_cnt) = M_s_com_k_i(1,1,link_count,bodies_cnt);
        
        g_s_link_as(1:3,4,link_count) = g_s_link_as(1:3,4,link_count) +  mass_of_body_of_metalink(bodies_cnt) * g_s_com_k_i(1:3,4,link_count,bodies_cnt);
    end
end

end